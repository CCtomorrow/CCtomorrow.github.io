<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Jenkins自动打包配置 · CCtomorrow</title><meta name="description" content="Jenkins自动打包配置 - CCtomorrow"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.qingyongai.com/atom.xml" title="CCtomorrow"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://github.com/CCtomorrow" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Jenkins自动打包配置</h1><div class="post-info">Aug 12, 2016</div><div class="post-content"><p>当时也是花费了不少时间来配置Jenkins自动打包的问题，觉得还是需要记录一下。<br>1.安装Jenkins，这个很简单，不需要多说。<br>2.下载Git Plugin，Gradle Plugin，Android Emulator Plugin（这个可以配置SDK路径，觉得这个插件挺好），<br>Email Extension Plugin 邮件提醒插件，自带的邮件提醒插件确实太弱。<br>3.配置，SDK路径，JDK路径，Git路径，Gradle路径。</p>
<p>配置git:<br>git config –global user.name “name”<br>git config –global user.email email<br>查看:<br>cat /root/.gitconfig<br>root是指当前的用户</p>
<p>生成公钥和私钥:<br>ssh-keygen -t rsa -C “email”</p>
<a id="more"></a>
<p>邮件配置:<br>Default Subject<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">构建通知:$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!</span><br></pre></td></tr></table></figure></p>
<p>Default Content<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">(本邮件是程序自动下发的，请勿回复！)<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">项目名称：$PROJECT_NAME<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">构建编号：$BUILD_NUMBER<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">构建状态：$BUILD_STATUS<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">触发原因：$&#123;CAUSE&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">构建日志地址：<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;BUILD_URL&#125;console"</span>&gt;</span>$&#123;BUILD_URL&#125;console<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">构建地址：<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$BUILD_URL"</span>&gt;</span>$BUILD_URL<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">变更集:$&#123;JELLY_SCRIPT,template="html"&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>4.项目配置<br>4.1构建一个自由风格的软件项目<br>4.2git地址配置，我们是专门创建一个用户用来拉取项目打包，如果使用ssh记得配置私钥和公钥（我们是使用gitblit，需要在gitblit上面配置公钥，Jenkins里面配置私钥）</p>
<p>分支配置</p>
<p>Additional Behaviours<br>高级配置，clone时间等</p>
<p>4.3Poll SCM，触发器配置<br>H/30 23 <em> </em> 1-5 表示星期一到星期五每天晚上23:30分构建一次。<br>第一个参数代表的是分钟 minute，取值 0~59；<br>第二个参数代表的是小时 hour，取值 0~23；<br>第三个参数代表的是天 day，取值 1~31；<br>第四个参数代表的是月 month，取值 1~12；<br>第五个参数代表的是星期 week，取值 0~7，0 和 7 都是表示星期天。<br>如H/5 表示的就是每5分钟检查一次源码变化。</p>
<p>4.4配置gradle task<br>由于每个项目，每个修改的用户都不一样，所以我们的gradle.properties是配置在电脑的user/.gradle/gradle.properties这里的，这个文件里面配置了我们的私有maven库的地址，keystore的位置，所以呢，我们项目里面的gradle.properties是空的，会单独写个config.gradle文件来重新生成这个文件。这个文件执行可以防止setting.gradle里面，因为这个是最先执行的，但是这样的话，会有干扰，因为只有Jenkins打包的时候才会需要重新修改gradle.properties文件，所以呢，我们这个文件是独立的。</p>
<p>配置gradle命令执行config.gradle文件里面的task<br>-q -b config.gradle taskname 大概是这样</p>
<p>配置clean等命令<br>clean build</p>
<p>执行完成之后可以在写个gradle文件去执行把打包好的apk文件拷贝到指定的地点。</p>
<p>4.5邮件配置<br>主要是高级设置里面，需要配置，Triggers，触发什么时候需要发邮件。</p>
<p>哈哈，当然，我这篇文章写的简短，但是其实过程中遇到很多问题，大概折腾两三天，Win上面还好，Linux上面会有很多依赖库的问题，我是分别在Linux和Windows上面都调试好了滴。</p>
<p>遇到问题可以看<a href="http://www.jianshu.com/p/c1b1b2817d90" target="_blank" rel="noopener">http://www.jianshu.com/p/c1b1b2817d90</a>这篇文章，写的很好。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/02/23/Charles_Use/" class="prev">PREV</a><a href="/2016/08/10/Android_HotFix_three/" class="next">NEXT</a></div><div data-thread-key="2016/08/12/Jenkins_Auto_Build_Apk/" data-title="Jenkins自动打包配置" data-url="http://www.qingyongai.com/2016/08/12/Jenkins_Auto_Build_Apk/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"[object Object]"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2018 <a href="http://www.qingyongai.com">CCtomorrow</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>