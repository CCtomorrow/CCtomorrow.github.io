<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="Qingyongai Blog">
<meta property="og:url" content="http://www.qingyongai.com/index.html">
<meta property="og:site_name" content="Qingyongai Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Qingyongai Blog">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Qingyongai Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-78820139-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Qingyongai Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">专注 Android 开发</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/22/Activity插件化(三)/" itemprop="url">
                  Activity插件化(三)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-22T21:35:40+08:00" content="2017-10-22">
              2017-10-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/插件化/" itemprop="url" rel="index">
                    <span itemprop="name">插件化</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/10/22/Activity插件化(三)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/10/22/Activity插件化(三)/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/10/22/Activity插件化(三)/" class="leancloud_visitors" data-flag-title="Activity插件化(三)">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>上面一篇文章已经实现了Intent解析和targetClass的还原工作，这篇文章会来说说:</p>
<h4 id="1-插件apk的解析"><a href="#1-插件apk的解析" class="headerlink" title="1. 插件apk的解析"></a>1. 插件apk的解析</h4><h4 id="2-ClassLoader的问题"><a href="#2-ClassLoader的问题" class="headerlink" title="2. ClassLoader的问题"></a>2. ClassLoader的问题</h4><h4 id="3-资源的问题"><a href="#3-资源的问题" class="headerlink" title="3. 资源的问题"></a>3. 资源的问题</h4><h4 id="4-插件的下载，加载机制的问题"><a href="#4-插件的下载，加载机制的问题" class="headerlink" title="4. 插件的下载，加载机制的问题"></a>4. 插件的下载，加载机制的问题</h4><h4 id="1-插件apk的解析-1"><a href="#1-插件apk的解析-1" class="headerlink" title="1.插件apk的解析"></a>1.插件apk的解析</h4><p>说到这个我们很容易想到一般的apk的安装过程也是需要解析apk的信息的，下面贴一篇比较好的文章。<br><a href="http://www.jianshu.com/p/953475cea991" target="_blank" rel="noopener">Android APK安装过程分析</a></p>
<p>图片取自上面的博客，apk的安装过程与pms有很大的关系，很多操作都是由pms完成的，有兴趣的可以去了解。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/10/22/Activity插件化(三)/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/20/Activity插件化(二)/" itemprop="url">
                  Activity插件化(二)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-20T21:35:40+08:00" content="2017-09-20">
              2017-09-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/插件化/" itemprop="url" rel="index">
                    <span itemprop="name">插件化</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/09/20/Activity插件化(二)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/09/20/Activity插件化(二)/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/09/20/Activity插件化(二)/" class="leancloud_visitors" data-flag-title="Activity插件化(二)">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>上一篇文章里面我们分析了一下Activity插件化并提出了5个问题，然后有的问题给出了解决方案，有的问题没有给出解决方案，不用担心，会有一系列的文章来循序渐进的把Activity插件化过程中遇到的问题慢慢讲清楚。<br>本文代码:<a href="https://github.com/qingyongai/PluginDemo/tree/activity_plugin_01" target="_blank" rel="noopener">PluginDemo/activity_plugin</a></p>
<h3 id="这篇文章只讲一个问题，Activity插件化占坑实现方式"><a href="#这篇文章只讲一个问题，Activity插件化占坑实现方式" class="headerlink" title="这篇文章只讲一个问题，Activity插件化占坑实现方式"></a>这篇文章只讲一个问题，Activity插件化占坑实现方式</h3><p>后续文章将要讲到的，现阶段不讲的:</p>
<ol>
<li>外部apk的解析</li>
<li>ClassLoader问题</li>
<li>资源文件问题</li>
</ol>
<h4 id="1-最简单Activity完全插件化实现方式"><a href="#1-最简单Activity完全插件化实现方式" class="headerlink" title="1.最简单Activity完全插件化实现方式"></a>1.最简单Activity完全插件化实现方式</h4><p>了解Activity的启动过程就应该知道启动Activity调用的是<code>Instrumentation</code>的<code>execStartActivity</code>方法完成的。等到AMS完成校验，以及在需要的时候创建进程等等一系列的操作之后会回到App进程，最后依旧调用<code>Instrumentation</code>的另外一个方法<code>newActivity</code>。所以我们Hook掉<code>ActivityThread</code>的<code>Instrumentation</code>的实例<code>mInstrumentation</code>即可。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/09/20/Activity插件化(二)/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/22/Activity插件化(一)/" itemprop="url">
                  Activity插件化(一)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-08-22T21:35:40+08:00" content="2017-08-22">
              2017-08-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/插件化/" itemprop="url" rel="index">
                    <span itemprop="name">插件化</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/08/22/Activity插件化(一)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/08/22/Activity插件化(一)/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/08/22/Activity插件化(一)/" class="leancloud_visitors" data-flag-title="Activity插件化(一)">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="首先说明一下"><a href="#首先说明一下" class="headerlink" title="首先说明一下:"></a>首先说明一下:</h4><p>本文的编写借鉴参考了大量的文章，有的可能是直接把文字拷贝过来的，我会在文中给出链接，如果有侵权，请联系我删除，谢谢。</p>
<p>我们知道，启动Activity可以是通过Activity或者通过Context，这两种启动没有太大的区别，最终都是调用<code>Instrumentation</code>的方法来启动的，当然说是这样说，其实还是有区别滴，Activity的startActivity()方法可使用默认配置的LAUNCH FLAG，而Context的startActivity()须包含<code>FLAG_ACTIVITY_NEW_TASK</code>的LAUNCH FLAG，原因是该Context可能没有现存的任务栈供新建的Activity使用，必须显式指定生成一个自己单独的任务栈。</p>
<p>Activity启动发起后，通过Binder，最终由system_server进程中的AMS(ActivityManagerService)启动的。这里不打算说Activity的启动过程了，因为套路就是那样，太多的博客文章也分析过了过程。想看启动过程的可以去看看下面的文章:<br><a href="http://gityuan.com/2016/03/12/start-activity/" target="_blank" rel="noopener">startActivity启动过程分析</a><br><a href="http://blog.csdn.net/zhaokaiqiang1992/article/details/49428287" target="_blank" rel="noopener">Activity启动过程全解析</a></p>
<p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/08/22/Activity插件化(一)/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/23/Git用法全/" itemprop="url">
                  Git 用法全
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-23T21:35:40+08:00" content="2017-07-23">
              2017-07-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Git/" itemprop="url" rel="index">
                    <span itemprop="name">Git</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/07/23/Git用法全/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/23/Git用法全/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/07/23/Git用法全/" class="leancloud_visitors" data-flag-title="Git 用法全">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="先推荐两本书-ProGit，Git-Community-Book-中文版"><a href="#先推荐两本书-ProGit，Git-Community-Book-中文版" class="headerlink" title="先推荐两本书:ProGit，Git Community Book 中文版"></a>先推荐两本书:<a href="https://git-scm.com/book/zh" target="_blank" rel="noopener">ProGit</a>，<a href="http://gitbook.liuhui998.com/index.html" target="_blank" rel="noopener">Git Community Book 中文版</a></h4><h4 id="1-记录每次更新"><a href="#1-记录每次更新" class="headerlink" title="1.记录每次更新"></a>1.记录每次更新</h4><p>工作目录下的文件都只有两种状态:已跟踪或者未跟踪。<br>已跟踪的文件指那些已经纳入了版本控制，在上次快照中有他们的记录，工作一段时间后，他们的状态可能处于已修改，未修改或者已放入暂存区。<br>除此之外的文件就是未跟踪的，他们既不存在快照中，也没放入暂存区。</p>
<h5 id="1-1-检查文件的状态-git-status"><a href="#1-1-检查文件的状态-git-status" class="headerlink" title="1.1.检查文件的状态:git status"></a>1.1.检查文件的状态:git status</h5><p><img src="http://dd089a5b.wiz03.com/share/resources/faadbdf1-640a-4283-961e-b46ac7a57c62/index_files/52586039.png" alt="检查文件的状态"></p>
<h5 id="1-2-跟踪新文件-git-add"><a href="#1-2-跟踪新文件-git-add" class="headerlink" title="1.2.跟踪新文件:git add "></a>1.2.跟踪新文件:git add <file></file></h5><p><img src="http://dd089a5b.wiz03.com/share/resources/faadbdf1-640a-4283-961e-b46ac7a57c62/index_files/53526870.png" alt="跟踪新文件"><br>可以看到文件已被跟踪，并处于暂存状态。<br>git add 使用文件或者目录作为参数，如果是目录的话，会递归跟踪目录下的所有文件。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/07/23/Git用法全/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/28/代理模式与Binder/" itemprop="url">
                  Java代理模式与Binder
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-28T23:43:40+08:00" content="2017-06-28">
              2017-06-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/插件化/" itemprop="url" rel="index">
                    <span itemprop="name">插件化</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/28/代理模式与Binder/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/28/代理模式与Binder/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/06/28/代理模式与Binder/" class="leancloud_visitors" data-flag-title="Java代理模式与Binder">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>这次准备写一系列的关于自己学习插件化的过程了，前面虽然陆陆续续的学习了一些插件化方面的知识，但是都是淡淡续续的，这次要从基础开始了，其实我一直认为基础这个东西挺重要的。</p>
<p>本文代码在我的Github上面:<a href="https://github.com/qingyongai/PluginDemo/tree/understand_plugin/javaproxy" target="_blank" rel="noopener">Plugin Demo</a></p>
<p>这里首先说明一下代理模式在插件化中的作用，代理其实就是劫持一个类，然后在执行指定的方法的时候，做一些事，一些什么事情呢，比如在前面或者后面加个统计，或者直接替换原来的执行逻辑，换成自己的逻辑。</p>
<p>其他比如，我们需要在不同的情况下返回同一个方法的不同实现也可以使用代理模式的，比如在做Push的时候，我们可能在App里面不止使用了一个推送服务，比如很多App会同时集成，个推和小米以及华为的推送，那么我们需要在不同的手机上面使用不同的推送，小米和和华为手机上面使用他们自己的，其余的手机上面使用个推的。那这个时候就可以使用代理模式来实现，因为推送基本就那几个方法，一是开启推送，一是给设备打标签等等方法需要我们实现。那分别用几个实现类实现即可，好吧，其实这个是策略模式，逃。</p>
<p>我们时常会看到别人说hook，特别是在插件化的时候，hook住Activity的启动，通过预先埋在Manifest里面的Activity，替换成我们真正想要启动的Activity等等的说法。通常Hook，又叫钩子，通常是指对一些方法进行拦截。这样当这些方法被调用时，也能够执行我们自己的代码，这也是面向切面编程的思想（<a href="https://www.zhihu.com/question/24863332" target="_blank" rel="noopener">AOP</a>）。<br>Android中，本身并不提供这样的拦截机制，但是有时候，我们可以在一些特殊的场合实现一种的Hook方法。<br>大致思路：<br>1.找到需要Hook方法的系统类<br>2.利用代理模式来代理系统类的运行拦截我们需要拦截的方法<br>3.使用反射的方法把这个系统类替换成你的代理类<br>上面的一段话取自<a href="http://blog.csdn.net/yulong0809/article/details/56842027" target="_blank" rel="noopener">插件化知识详细分解及原理 之代理，hook，反射</a>，感觉说的挺好。这里是不是就能感受到代理模式的强大了，下面会细说的。</p>
<p>代理模式的意思就是为其他对象提供一种代理以控制对这个对象的访问，一般当我们无法或者不想直接访问某个对象或者访问某个对象存在困难时，可以用过一个代理对象来间接访问。(下图出自:<a href="http://www.jianshu.com/p/6f6bb2f0ece9" target="_blank" rel="noopener">代理模式及Java实现动态代理</a>)<br><img src="http://dd089a5b.wiz03.com/share/resources/74ce24d8-7c17-4545-b764-fc1d3820c181/index_files/86356234.png" alt="代理模式UML图"><br>java中的代理模式大概可以分为两种，一种就是普通的代理也就是静态代理，就是我们生成固定的代码，在我们运行前代理类的class编译文件就已经存在啦，动态代理与静态代理相反，在code阶段压根不需要知道代理谁，代理谁将会在代码的执行阶段通过一些判断来决定代理哪个对象。动态代理其实如果细分也可以分成两类，一类是JDK提供的代理，一类是<a href="https://github.com/cglib/cglib" target="_blank" rel="noopener">cglib</a>提供的代理类，他们的区别是:<br><em>JDK动态代理只能对实现了接口的类生成代理，而不能针对类 。<br>CGLIB是针对类实现代理，主要是对指定的类生成一个子类，覆盖其中的方法 。<br>因为是继承，所以该类或方法最好不要声明成final ，final可以阻止继承和多态。</em></p>
<h5 id="这里需要注意，因为是代理模式，肯定是需要真正代理某个类的，也就是说需要真正做事得类，然后对这个类进行代理。这点是基础，不然说不定你会越看越懵逼。"><a href="#这里需要注意，因为是代理模式，肯定是需要真正代理某个类的，也就是说需要真正做事得类，然后对这个类进行代理。这点是基础，不然说不定你会越看越懵逼。" class="headerlink" title="这里需要注意，因为是代理模式，肯定是需要真正代理某个类的，也就是说需要真正做事得类，然后对这个类进行代理。这点是基础，不然说不定你会越看越懵逼。"></a>这里需要注意，因为是代理模式，肯定是需要真正代理某个类的，也就是说需要真正做事得类，然后对这个类进行代理。这点是基础，不然说不定你会越看越懵逼。</h5>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/06/28/代理模式与Binder/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/05/React Native基础之props，state，style/" itemprop="url">
                  React Native基础之props，state，style
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-05T23:42:40+08:00" content="2017-06-05">
              2017-06-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/React-Native/" itemprop="url" rel="index">
                    <span itemprop="name">React Native</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/05/React Native基础之props，state，style/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/05/React Native基础之props，state，style/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/06/05/React Native基础之props，state，style/" class="leancloud_visitors" data-flag-title="React Native基础之props，state，style">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="本人是搞安卓的，所以。。。"><a href="#本人是搞安卓的，所以。。。" class="headerlink" title="本人是搞安卓的，所以。。。"></a>本人是搞安卓的，所以。。。</h3><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p>搭建开发环境就不说啦。</p>
<h5 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h5><p>搭建好开发环境之后，找个目录，创建项目，然后运行项目，创建出来的项目的gradle的版本如果本地没有的话，建议改成本地有的，不然要下载好久。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">react-native init 项目名</span><br><span class="line">cd 项目目录</span><br><span class="line">react-native run-android</span><br></pre></td></tr></table></figure></p>
<p><em>提示:</em>你可以使用–version参数创建指定版本的项目。<br>例如react-native init MyApp –version 0.39.2。注意版本号必须精确到两个小数点。</p>
<p>还有一点，RN的菜单需要按菜单键才能出来，但是现在很多手机都没有菜单键啦，RN肯定早就考虑到啦这一点，摇一摇手机就出来啦。</p>
<h5 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; AppRegistry, Text &#125; from &apos;react-native&apos;;</span><br><span class="line"></span><br><span class="line">class HelloWorldApp extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;Text&gt;Hello world!&lt;/Text&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 注意，这里用引号括起来的&apos;HelloWorldApp&apos;必须和你init创建的项目名一致</span><br><span class="line">AppRegistry.registerComponent(&apos;HelloWorldApp&apos;, () =&gt; HelloWorldApp);</span><br></pre></td></tr></table></figure>
<p>RN的Hello World程序如上面所示的。<br>上面的示例代码中的import、from、class、extends、以及() =&gt;箭头函数等新语法都是ES2015（也叫作ES6）中的特性。如果你不熟悉ES2015的话，可以看看<a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener">阮一峰老师的书</a>，还有论坛的这篇<a href="http://bbs.reactnative.cn/topic/15" target="_blank" rel="noopener">总结</a>。<br><em>提示:</em>顺便说一句，阮一峰老师的博客写的真的很好，很多东西都讲的非常透彻。</p>
<p>上面的代码定义了一个名为<code>HelloWorldApp</code>的新的组件（Component），并且使用了名为<code>AppRegistry</code>的内置模块进行了“注册”操作。你在编写<code>React Native</code>应用时，肯定会写出很多新的组件。而一个App的最终界面，其实也就是各式各样的组件的组合。组件本身结构可以非常简单——唯一必须的就是在<code>render</code>方法中返回一些用于渲染结构的<code>JSX</code>语句。</p>
<p><code>AppRegistry</code>模块则是用来告知<code>React Native</code>哪一个组件被注册为整个应用的根容器。你无需在此深究，因为一般在整个应用里<code>AppRegistry.registerComponent</code>这个方法只会调用一次。上面的代码里已经包含了具体的用法，你只需整个复制到index.ios.js或是index.android.js文件中即可运行。<br><em>提示:</em>上面的话出自<a href="https://reactnative.cn/docs/0.44/tutorial.html#content" target="_blank" rel="noopener">编写Hello World</a>。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/06/05/React Native基础之props，state，style/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/05/Android的资源管理器的创建过程/" itemprop="url">
                  Android的资源管理器的创建过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-05T23:43:40+08:00" content="2017-05-05">
              2017-05-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/插件化/" itemprop="url" rel="index">
                    <span itemprop="name">插件化</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/05/Android的资源管理器的创建过程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/05/Android的资源管理器的创建过程/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/05/05/Android的资源管理器的创建过程/" class="leancloud_visitors" data-flag-title="Android的资源管理器的创建过程">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>最近在研究Android的插件化，插件化需要解决的问题大概有这样的几个，为什么需要插件化技术这个就不说啦。</p>
<ul>
<li>资源访问</li>
<li>组件的生命周期的管理</li>
</ul>
<p>参考:<br><a href="http://blog.csdn.net/luoshengyang/article/details/8738877" target="_blank" rel="noopener">Android资源管理框架（Asset Manager）简要介绍和学习计划</a><br><a href="http://blog.csdn.net/luoshengyang/article/details/6685853" target="_blank" rel="noopener">Android应用程序的Activity启动过程简要介绍和学习计划</a><br><a href="http://blog.csdn.net/singwhatiwanna/article/details/18154335" target="_blank" rel="noopener">Android源码分析-Activity的启动过程</a></p>
<p>这篇文章浅解一下Android的资源管理器的创建过程。这里说一下，其实很多人对插件化的资源加载有一个误区呀，就是一般别人说插件化需要解决一个资源冲突的问题，这里有一个很重要的问题。</p>
<h3 id="为什么会有资源冲突的问题？"><a href="#为什么会有资源冲突的问题？" class="headerlink" title="为什么会有资源冲突的问题？"></a>为什么会有资源冲突的问题？</h3><p>这个问题其实不应该放在最前面说的，但是很多人都有一个误区，感觉必须先说一下这个了。<br>首先看Android的资源分类，Android的资源可分为两大类。分别是Asserts和Res。</p>
<ul>
<li>Asserts<br>assets类资源放在工程根目录的Assets子目录下，这些文件最终会被原装不动地打包在apk文件中。如果我们要在程序中访问这些文件，那么就需要指定文件名来访问。</li>
<li>Res<br>res资源比较多，放一张图吧，基本一看就明白。<br><img src="http://dd089a5b.wiz03.com/share/resources/a20dafc7-ab84-4bcb-a155-fd128ecb9496/index_files/85903154.png" alt="res资源类型.png"></li>
</ul>
<p>res资源大概是这样的啦，当然还有raw以及xml等资源啦。在编译打包的过程中，会把资源文件打包成二进制文件(.xml文件打包成二进制文件，png文件进行优化等)。会对除了assets资源之外所有的资源赋予一个资源ID常量，并且会生成一个资源索引表resources.arsc。</p>
<p>这个resources.arsc文件记录了所有的应用程序资源目录的信息，包括每一个资源名称、类型、值、ID以及所配置的维度信息。我们可以将这个resources.arsc文件想象成是一个资源索引表，这个资源索引表在给定资源ID和设备配置信息的情况下，能够在应用程序的资源目录中快速地找到最匹配的资源。</p>
<p>这些资源ID被终会被定义为Java常量值，保存在一个R.java文件中，与应用程序的其它源文件一起被编译到程序中，这样我们就可以在程序或者资源文件中通过这些ID常量来访问指定的资源。</p>
<p>资源ID的最终的格式是:<em>0xPPTTNNNN</em><br>资源ID是一个4字节的无符号整数，其中，最高字节表示Package ID，次高字节表示Type ID，最低两字节表示Entry ID。</p>
<ul>
<li>PP Package ID相当于是一个命名空间，限定资源的来源。<br>Android系统当前定义了两个资源命令空间，其中一个系统资源命令空间（比如我们可以直接引用系统提供好的主题等），它的Package ID等于0x01，另外一个是应用程序资源命令空间，它的Package ID等于0x7F。系统资源包的Package ID就等于0x01，而我们在应用程序中定义的资源的Package ID的值都等于0x7F，上图就可以看出来的。</li>
<li>TT Type ID是指资源的类型ID。<br>资源的类型有animator、anim、color、string和xml等等若干种，每一种都会被赋予一个ID。上图也可以看出来的。</li>
<li>NNNN Entry ID是指每一个资源在其所属的资源类型中所出现的次序。<br>注意，不同类型的资源的Entry ID有可能是相同的，但是由于它们的类型不同，我们仍然可以通过其资源ID来区别开来。</li>
</ul>
<p>上面说这么多就是想说，我们写的App通常情况下资源等的ID都是0x7F开始的，插件化的时候，开发插件是当作一个App来开发的，打包的时候资源ID也是0x7F开始的，所以呢，这个插件与插件，插件与宿主的资源ID很有可能是一样的。</p>
<p><em>下面说的是重点:</em><br>在插件化的开发过程中，加载插件的资源可以单独创建了用于访问插件资源的AssertManager和Resource对象，即插件独立使用一个资源管理器，<em>这样宿主访问宿主的资源，插件访问插件的资源，这样子是不会出现资源冲突问题的。</em>然而这个(插件使用单独的资源管理器)在现实中是不切实际的，一般都会将插件的资源路径添加到宿主的AssetManager中，这样做的原因是为了插件与宿主之间的资源共享，资源共享的原因主要是为了减少插件的体积。<br>现阶段对资源冲突的解决方案:</p>
<ul>
<li>修改aapt源码，定制aapt工具编译期间修改PP段。<br>例如:<a href="https://github.com/alibaba/atlas" target="_blank" rel="noopener">atlas</a></li>
<li>修改aapt的产物，即编译后期重新整理插件Apk的资源，编排ID。<br>例如:<a href="https://github.com/wequick/Small" target="_blank" rel="noopener">Small</a><br>这两种方案都可以，修改aapt的源代码，虽然说比较麻烦，但是其实需要修改的代码是比较少的，不过需要你有个Android的源码的环境才能编译出aappt可执行文件，修改aapt的产物，一般是写gradle插件来实现，因为Android的源代码是知道的，所以我们能知道aapt最后生成的二进制文件的格式，然后自己整理资源的ID。</li>
</ul>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/05/05/Android的资源管理器的创建过程/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/26/手把手教你写Router框架入门篇/" itemprop="url">
                  手把手教你写Router框架入门篇
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-03-26T23:43:40+08:00" content="2017-03-26">
              2017-03-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/Router/" itemprop="url" rel="index">
                    <span itemprop="name">Router</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/03/26/手把手教你写Router框架入门篇/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/26/手把手教你写Router框架入门篇/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/03/26/手把手教你写Router框架入门篇/" class="leancloud_visitors" data-flag-title="手把手教你写Router框架入门篇">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>本文代码在<a href="https://github.com/qingyongai/SimpleRouterDemo" target="_blank" rel="noopener">Github</a>上面，可以自行查看，代码还是挺简单的。</p>
<p>最近项目在组件化，模块内的跳转使用了Router框架，通信暂时还有用的接口，没想到好的方法。关于组件化和Router框架是什么这里不作介绍请自行Google。<br>Router框架的好处可以解耦，还有在Push的时候可能会比较方便，在后台直接配置Activity的名称硬编码并不好，还有一个是一般现在的客户端，App里面的模块都有Web版的，使用Router框架的话，在跳转的过程中，如果本地模块没有可以去自动做些处理，使用浏览器打开对应的模块的。<br>这篇文章着重说一下编译时候的注解处理器，其实注解的使用在Router框架中的占比非常小，主要的处理还是在Router库里面。由于我自己并不熟悉编译时的注解的写法，所以开篇的文章先写一下注解处理器的使用。</p>
<h3 id="不使用注解处理器的基本Router框架的写法"><a href="#不使用注解处理器的基本Router框架的写法" class="headerlink" title="不使用注解处理器的基本Router框架的写法"></a>不使用注解处理器的基本Router框架的写法</h3><p>路由框架，顾名思义就是通过一个路由地址可以跳转到对应的页面去。这里的页面只针对Activity，Fragment其实没必要，个人感觉Fragment最好通过Activity的参数处理。<br>为了对应起Activity和路由地址，我们需要有一个表来进行记录，这里路由地址最好制定好相关的协议，我是希望一个路由地址大概如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scheme://module/界面/params</span><br></pre></td></tr></table></figure></p>
<p>路由里面支持参数对于Push或者Web跳转到相应的界面是非常方便的。<br>一个不使用注解处理器的路由框架，需要自己手动把每个界面和相应的Activity对应起来。这个处理过程可以在Application里面做的。<br>大致步骤:<br>1.定义接口，让调用着可以去注册。<br>2.写RouterManager类，去实现跳转。<br>首先定义一个接口如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface IRoute &#123;</span><br><span class="line">    void initRouter(Map&lt;String, Class&lt;? extends Activity&gt;&gt; routers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用Map将路由地址和Activity关联起来。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/03/26/手把手教你写Router框架入门篇/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/03/Dagger2入门使用/" itemprop="url">
                  Dagger2入门使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-03-03T23:43:40+08:00" content="2017-03-03">
              2017-03-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/other/" itemprop="url" rel="index">
                    <span itemprop="name">other</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/03/03/Dagger2入门使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/03/Dagger2入门使用/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/03/03/Dagger2入门使用/" class="leancloud_visitors" data-flag-title="Dagger2入门使用">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>dagger 1.x 以前只是听说过，没使用过，也不打算再研究啦。<br>最近在看有关组件化的文章，讲道理，组件化如果约定好了，唯一需要解决的可能就是组件之间的通信了。<br>按照我的理解，组件化大概是这样:基础库+组件+组件+…+主module，基础库可以按照功能分成style库，util库，自定义控件库，这些库可以发布到内部maven里面，各个组件可以引用其中的某个库，或者引用所有的，或者不引用。<br>各个组件之间的通信分为两个部分，一个是组件之间的跳转，一个是组件的数据交换，对于组件之间的跳转可以使用Router之类的库，组件之间的数据交换可能就会比较麻烦了。<br>组件间的数据交换，我的初步想法是通过接口，需要交换的数据写一些接口也做成一个库，其他的组件可以引用这个库，做处理然后返回对应的数据。<br>有大神提到他们公司的组件之间的通信是使用的一个二次开发的dagger2库，所以这次主要来写篇daager2的入门使用文章。</p>
<p>dagger2库的地址:<a href="https://github.com/google/dagger" target="_blank" rel="noopener">https://github.com/google/dagger</a></p>
<h2 id="依赖配置"><a href="#依赖配置" class="headerlink" title="依赖配置"></a>依赖配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    // 你的其他依赖库</span><br><span class="line">    compile &apos;com.google.dagger:dagger:2.9&apos;</span><br><span class="line">    annotationProcessor &apos;com.google.dagger:dagger-compiler:2.9&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>dagger2采用的是编译时注解时注解，以前可能用的是apt，Gradle从2.2版本开始支持annotationProcessor功能来代替Android-apt。android-apt插件作者近期已经发表声明表示后续不会再继续维护该插件。<br>关于如何从apt切换到annotationProcessor可以参考下图。<br><img src="http://dd089a5b.wiz03.com/share/resources/1221d000-61ed-4a7a-82c9-50663c0c9cd9/index_files/85285789.png" alt="apt"><br>图取自 <a href="http://blog.csdn.net/dd864140130/article/details/53957691" target="_blank" rel="noopener">拓展篇：注解处理器最佳实践</a></p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>好吧，其实看了官方Demo，和很多文章之后，感觉dagger2就是用来生成对象的，当然它用编译时注解做了一些自动化的事情（妈蛋，不要看一些文章说什么依赖注入，听着好像挺厉害的样子，很多时候不是自己不够聪明，而是别人说的不够明白）。以前学习过spring，了解过一些这方面的知识。</p>
<p>daager2的好处呢，一是因为生成对象在一个独立的地方，所以修改的时候方便些，测试会简单些，还有就是如果一个对象需要很多其他对象的引用，使用dagger2生成会方便很多的。</p>
<ul>
<li><p>@Inject<br>既然dagger2是用来生成对象的，我们肯定需要知道哪些对象是需要生成的啦，这个注解其中一个作用就是用来告诉dagger2，这个对象需要被生成。<br>还有一个作用是给构造方法添加此注解，标记构造函数，dagger2通过@Inject注解可以在需要这个对象的时候，找到这个构造函数并生成对象，给被@Inject标记了的变量提供对象。</p>
</li>
<li><p>@Module<br>@Module用于标注提供对象的类。上面已经提供了@Inject，这里还提供@Module，其实呢，当需要生成的对象是第三方的jar包，或者对象有构造参数的时候，@Inject并不会特别的方便。</p>
</li>
<li><p>@Provides<br>用于标注@Module标注的类中，提供对象的方法。</p>
</li>
<li><p>@Component<br>用于标注接口，是@Inject和@Module之间的桥梁。被Component标注的接口在编译时会生成该接口的实现类（如果@Component标注的接口为CarComponent，则编译期生成的实现类为DaggerCarComponent）,我们通过调用这个实现类的方法完成对象的赋值。</p>
</li>
<li><p>@Qualifier<br>dagger里面在同一个Module里面提供两个相同的对象是不允许的，这样dagger无法分辨，这个时候就需要使用Qualifier去自定义不同的注解限定需要提供的是哪种类型的对象。</p>
</li>
<li><p>@Scope<br>用于自定义注解，可以通过@Scope自定义的注解来限定注解作用域，实现局部的单例。</p>
</li>
<li><p>@Singleton<br>一个通过Scope定义的注解，一般通过它来实现全局单例。但实际上它并不能提前全局单例，是否能提供全局单例还要取决于对应的Component是否为一个全局对象。</p>
</li>
</ul>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/03/03/Dagger2入门使用/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/23/使用Charles对Android App进行抓包/" itemprop="url">
                  使用Charles对Android App进行抓包
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-02-23T23:43:40+08:00" content="2017-02-23">
              2017-02-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/other/" itemprop="url" rel="index">
                    <span itemprop="name">other</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/02/23/使用Charles对Android App进行抓包/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/23/使用Charles对Android App进行抓包/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/02/23/使用Charles对Android App进行抓包/" class="leancloud_visitors" data-flag-title="使用Charles对Android App进行抓包">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="使用Charles对Android-App进行抓包"><a href="#使用Charles对Android-App进行抓包" class="headerlink" title="使用Charles对Android App进行抓包"></a>使用Charles对Android App进行抓包</h2><p>记录一下，方便日后查找</p>
<h3 id="1-软件下载地址"><a href="#1-软件下载地址" class="headerlink" title="1.软件下载地址"></a>1.软件下载地址</h3><p>这里就不提供啦。</p>
<h3 id="2-Mac配置"><a href="#2-Mac配置" class="headerlink" title="2.Mac配置"></a>2.Mac配置</h3><p>1.Help –&gt; SSL Proxying –&gt; Install Charles Root Certificate<br>2.Proxy Settings –&gt; port 8888 Enable transparent HTTP proxying<br>3.SSL Proxying Settings –&gt; Enable SSL Proxying 同时添加需要监听的接口，可使用*通配符</p>
<h3 id="3-Android手机配置"><a href="#3-Android手机配置" class="headerlink" title="3.Android手机配置"></a>3.Android手机配置</h3><p>1.连接和Mac的同一个WIFI，同时设置此WIFI的代理服务器，ip即这台电脑连接的WIFI的ip，端口8888.<br>2.Help –&gt; SSL Proxying –&gt; Save Charles Root Certificate 然后把证书拷贝到手机上面安装</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="QingYong" />
          <p class="site-author-name" itemprop="name">QingYong</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">22</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">QingYong</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"qingyongai"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  






  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("4j8wvWRHUMyi2KAl3m0xFedh-gzGzoHsz", "mBX6wGr6OcLWOzIaX5wEFD0Y");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
